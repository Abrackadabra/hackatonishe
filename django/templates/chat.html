<html>
<head>
    <title>
        Chat
    </title>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script>
    function getCookie(name) {
        var matches = document.cookie.match(new RegExp(
          "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
        ))
        return matches ? decodeURIComponent(matches[1]) : undefined 
    }
    $( document ).ready(function() {
        host = 'http://0.0.0.0:5555'; 
        var my_id = getCookie('key');
        urlparts = document.URL.split('/');
        var stranger_id = urlparts[urlparts.length - 1]
        setInterval( function()
        {
            $.get( host + "/chat/" + stranger_id + "/recv", function( data ) {
                $.each(data['messages'], function(index, value) {
                    $('#box').html("<b> Stranger: </b>" + value + '</br>' + $('#box').html());
                })
            });

        }, 1000);
        send = function() {
            $('#box').html("<b> You: </b>" + $('#msg').val() + '</br>' + $('#box').html());
            $.ajax({
                type: "POST",
                url: host + "/chat/" + stranger_id + "/send",
                data: {'message': $('#msg').val() },
                success: function() {
                    console.log('sent');
                }
              ,
            });
            $('#msg').val('')
        }
    });
    </script>
</head>

<body>
<textarea id='msg'></textarea>
<a onclick='send()' href='#'> SEND </a>

<div id='box'>
</div>
</body>

</html>
